<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Water City All Time Stats</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { padding: 10px; border: 1px solid #ccc; text-align: left; }
    th { background: #eee; cursor: pointer; }
    tr:nth-child(even) { background: #f9f9f9; }
    #search { padding: 8px; width: 250px; }
  </style>
</head>
<body>
  <h1>Water City All Time Stats</h1>
  <input id="search" placeholder="Search players..." />

  <table id="table">
    <thead id="thead"></thead>
    <tbody id="tbody"></tbody>
  </table>

  <script>
    let sortKey = "points";
    let sortDir = "desc";
    let data = [];

    const HIDDEN_COLS = ["id", "memberid"]; // columns to hide

    fetch("hockey.json")
      .then(res => res.json())
      .then(json => { 
        data = json.map(player => ({
          ...player,
          averagePointsPerSeason: (player.seasonsplayed > 0) 
            ? (player.points / player.seasonsplayed).toFixed(2)
            : "0.00"
        }));
        renderTable(); 
      });

    document.getElementById("search").addEventListener("input", renderTable);

    function properCase(str) {
      return str
        .replace(/([A-Z])/g, ' $1')
        .replace(/seasonsplayed/i, "Seasons Played")
        .replace(/averagePointsPerSeason/i, "Average Points Per Season")
        .replace(/^./, c => c.toUpperCase());
    }

    function renderTable() {
      const search = document.getElementById("search").value.toLowerCase();
      let filtered = data.filter(row =>
        Object.values(row).join(" ").toLowerCase().includes(search)
      );

      filtered.sort((a, b) => {
        const A = a[sortKey];
        const B = b[sortKey];
        return sortDir === "asc" ? A - B : B - A;
      });

      const columns = Object.keys(data[0]).filter(c => !HIDDEN_COLS.includes(c));
      const thead = document.getElementById("thead");
      const tbody = document.getElementById("tbody");

      thead.innerHTML = "<tr>" +
        columns.map(col => `<th onclick=\"setSort('${col}')\">${properCase(col)}${sortKey===col ? (sortDir==='asc'?' ▲':' ▼') : ''}</th>`).join("") +
        "</tr>";

      tbody.innerHTML = filtered.map(row =>
        `<tr>${columns.map(c => `<td>${row[c]}</td>`).join("")}</tr>`
      ).join("");
    }

    function setSort(col) {
      if (sortKey === col) {
        sortDir = sortDir === "asc" ? "desc" : "asc";
      } else {
        sortKey = col;
        sortDir = "asc";
      }
      renderTable();
    }
  </script>
</body>
</html>
